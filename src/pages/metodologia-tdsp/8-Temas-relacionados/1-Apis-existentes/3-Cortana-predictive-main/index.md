---
title: 3-Mantenimiento predictivo
---
# <a name="cortana-intelligence-solution-template-playbook-for-predictive-maintenance-in-aerospace-and-other-businesses"></a>Cuaderno de estrategias de la plantilla de solución de Cortana Intelligence orientada al mantenimiento predictivo en empresas aeroespaciales y otras
## <a name="executive-summary"></a>Resumen ejecutivo
El mantenimiento predictivo es una de las aplicaciones más solicitadas del análisis predictivo, ya que sus beneficios, entre los que se incluye un gran ahorro de costos, son indiscutibles. El objetivo de este cuaderno de estrategias es servir de referencia para las soluciones de mantenimiento predictivo y en él se hace énfasis en casos de uso importantes.
Además, proporciona al lector información exhaustiva sobre los escenarios empresariales de mantenimiento predictivo más comunes, los desafíos de los problemas empresariales en que se pueden usar estas soluciones, los datos necesarios para resolver dichos problemas, las técnicas de modelado predictivo para crear soluciones con dichos datos y procedimientos recomendados con arquitecturas de solución de ejemplo.
En él también se describen los detalles de los modelos predictivos desarrollados, como la ingeniería de características, el desarrollo de modelos y la evaluación del rendimiento. En definitiva, este cuaderno de estrategias combina las directrices analíticas y empresariales necesarias para desarrollar e implementar correctamente soluciones de mantenimiento predictivo. Estas instrucciones se han elaborado para ayudar a los usuarios a crear una solución inicial con Cortana Intelligence Suite y, específicamente, con Azure Machine Learning como punto de partida en su estrategia de mantenimiento predictivo a largo plazo. La documentación relativa tanto a Cortana Intelligence Suite como a Azure Machine Learning se puede encontrar en las páginas de [Cortana Analytics](http://www.microsoft.com/server-cloud/cortana-analytics-suite/overview.aspx) y [Azure Machine Learning](https://azure.microsoft.com/services/machine-learning/).

> [!TIP]
> Para obtener instrucciones técnicas sobre la implementación de esta plantilla de solución, consulte [Guía técnica de la plantilla de solución de Cortana Intelligence orientada al mantenimiento predictivo en empresas aeroespaciales y de otros tipos](cortana-analytics-technical-guide-predictive-maintenance.md).
> Para descargar un diagrama que proporcione información general sobre la arquitectura de esta plantilla, consulte [Arquitectura de la plantilla de solución de Cortana Intelligence para mantenimiento predictivo en empresas aeroespaciales y otras](cortana-analytics-architecture-predictive-maintenance.md).
> 
> 

## <a name="playbook-overview-and-target-audience"></a>Introducción y audiencia de destino del cuaderno de estrategias
Este cuaderno de estrategias está organizado de modo que se beneficie todo tipo de público, tanto técnico como no técnico, con niveles distintos de experiencia y diferentes intereses en el espacio del mantenimiento predictivo. El cuaderno de estrategias abarca no solo aspectos de alto nivel de los diferentes tipos de soluciones de mantenimiento predictivo, sino también detalles de cómo implementarlos. El contenido está equilibrado, con el fin de satisfacer tanto al público que solo está interesado en conocer el espacio de la solución y el tipo de aplicaciones, como a aquellos cuyo objetivo es implementar estas soluciones y, por tanto, están interesados en los detalles técnicos.

La mayoría del contenido de este cuaderno de estrategias no asume que el lector tenga conocimientos previos de la ciencia de datos. Sin embargo, algunas de las partes requerirán cierta familiaridad con los conceptos de la ciencia de datos para poder seguir los detalles de implementación. Se necesitan conocimientos básicos de la ciencia de datos para sacar el máximo provecho al material de dichas secciones.

En la primera mitad del cuaderno de estrategias se realiza una introducción a las aplicaciones de mantenimiento predictivo y se explica cómo cualificar una solución de mantenimiento predictivo, una colección de casos de uso comunes con los detalles del problema empresarial, los datos que rodean dichos casos y los beneficios empresariales de la implementación de estas soluciones de mantenimiento predictivo. Estas secciones no requieren conocimientos técnicos de análisis predictivo.

En la segunda mitad del cuaderno de estrategias, se trataran los tipos de técnicas de modelado de predicción para aplicaciones de mantenimiento predictivo y cómo implementar dichos modelos a través de ejemplos de los casos de uso que se esbozan en la primera mitad. Para ilustrarlos se recorrerán los distintos pasos del preprocesamiento de datos como el etiquetado de datos y la ingeniería de características, la selección de modelos y los procedimientos recomendados de formación/pruebas y de evaluación del rendimiento. Estas secciones son adecuadas para un público técnico.

## <a name="predictive-maintenance-in-iot"></a>Mantenimiento predictivo en IoT
El impacto de un tiempo de inactividad no programado del equipamiento puede ser muy perjudicial para las empresas. Es fundamental mantener el equipamiento de campo en funcionamiento para maximizar el rendimiento y minimizar el costoso tiempo de inactividad no programado. El mero hecho de esperar a que se produzca un fallo es algo que no es posible permitirse en el actual marco de operaciones de las empresas. Para no perder competitividad, las compañías buscan nuevas formas de maximizar el rendimiento de los activos mediante el uso de los datos recopilados de distintos canales. Una forma importante de analizar dicha información es utilizar técnicas de análisis predictivo que usen patrones históricos para predecir resultados futuros. Una de las soluciones más populares se denomina Mantenimiento predictivo, que generalmente se puede definir, pero sin limitarse a ello, como la predicción de la posibilidad de que se produzca un fallo en un activo en un futuro próximo, con el fin de que se puedan supervisar los activos para identificar los fallos de forma proactiva y tomar medidas antes de que se produzcan los fallos. Estas soluciones detectan patrones de fallos para determinar los activos que tienen mayor riesgo de fallo. Esta identificación temprana de los problemas le ayuda a implementar recursos de mantenimiento limitado de una forma más rentable y a mejorar la calidad y los procesos de la cadena de suministro.

Con el aumento de las aplicaciones de Internet de las cosas (IoT) el mantenimiento predictivo empezó a recibir mayor atención del sector cuando la recopilación de datos y las tecnologías de procesamiento maduraron lo suficiente como para generar, transmitir, almacenar y analizar todos los tipos de datos en lotes o en tiempo real. Dichas tecnologías permiten el fácil desarrollo e implementación de soluciones completas con soluciones de análisis avanzado y con soluciones de mantenimiento predictivo que podría decirse que proporcionan el mayor beneficio.

Problemas empresariales en el intervalo del dominio del mantenimiento predictivo de alto riesgo operativo debido a fallos inesperados e información limitada sobre la causa de problemas en entornos empresariales complejos. La mayoría de estos problemas se puede encuadrar en las siguientes preguntas empresariales:

* ¿Cuál es la probabilidad de que un componente del equipo genere un error en un futuro cercano?
* ¿Cuál es la vida útil restante del equipamiento?
* ¿Cuáles son las causas de los fallos y qué acciones de mantenimiento deben realizarse para corregir estos problemas?

Si implementan un mantenimiento predictivo para dar respuesta a estas preguntas, las empresas podrán lograr estas ventajas:

* Reducir los riesgos operativos y aumentar la tasa de devolución de los recursos mediante la detección de errores antes de que se produzcan
* Reducir las operaciones de mantenimiento con duración definida innecesarias y controlar los costos de mantenimiento
* Mejorar la imagen de la marca en su conjunto y eliminar la mala publicidad y la pérdida de ventas derivadas del desgaste de los clientes
* Disminuir los costos de inventario mediante la reducción de los niveles de este último gracias a la previsión del punto en el que se debe hacer un nuevo pedido
* Detectar patrones asociados a diversos problemas de mantenimiento

Las soluciones de mantenimiento predictivo pueden proporcionar a las empresas indicadores de rendimiento claves, como puntuaciones del estado para supervisar el estado del activo en tiempo real, una estimación de la vida que queda a los activos, la recomendación de actividades de mantenimiento proactivas y fechas de pedido estimadas para la sustitución de las piezas.

## <a name="qualification-criteria-for-predictive-maintenance"></a>Criterios de cualificación para mantenimiento predictivo
Es importante destacar que el mantenimiento predictivo no puede resolver eficazmente todos los casos de uso o problemas empresariales. Los criterios de cualificación importantes incluyen si el problema es predictivo por naturaleza, que exista una ruta de acción clara para evitar fallos cuando se detectan con antelación y,lo más importante, si hay disponibles datos con calidad suficiente para dar soporte al caso de uso. Aquí nos centramos en los requisitos de datos para crear una solución de mantenimiento predictivo correcta.

Al construir modelos predictivos, usamos datos históricos para entrenar el modelo que reconoce patrones ocultos e identifica dichos patrones en los datos futuros. Estos modelos se entrenan con ejemplos descritos por sus características y el destino de la predicción. Se espera que el modelo entrenado realice predicciones en el destino exclusivamente mediante el examen de las características de los ejemplos nuevos. Es crucial que el modelo capture la relación entre las características y el destino de la predicción. Para entrenar un modelo eficaz de aprendizaje automático, se necesitan datos de aprendizaje, que incluyen características que realmente tienen poder predictivo sobre el destino de predicción, lo que significa que los datos deben ser relevantes para el objetivo de la predicción, para que las predicciones sean precisas.

Por ejemplo, si el objetivo es predecir fallos en las ruedas de un tren, los datos de entrenamiento deben contener contenidos relacionados con las ruedas (por ejemplo, una telemetría que refleje el estado de mantenimiento de las ruedas, el kilometraje, la carga del automóvil, etc.). Sin embargo, si el objetivo es predecir fallos en el motor de un tren, es probable que se necesite otro conjunto de datos de entrenamiento que tenga características relacionadas con el motor. Antes de generar modelos predictivos, esperamos que el experto empresarial conozca el requisito de relevancia de datos y proporcione el conocimiento del dominio que se necesita para seleccionar los subconjuntos relevantes de datos para el análisis.

A la hora de determinar si un problema empresarial es adecuado para una solución de mantenimiento predictivo, buscamos tres orígenes de datos esenciales:

1. Historial de errores: normalmente, en las aplicaciones de mantenimiento predictivo, es muy raro que se produzcan eventos de fallo. Sin embargo, al generar modelos predictivos que predicen fallos, el algoritmo necesita aprender el patrón de funcionamiento normal, así como el patrón de fallo a través del proceso de entrenamiento. Por consiguiente, es esencial que los datos de entrenamiento contengan un número suficiente de ejemplos de ambas categorías para aprender los dos patrones diferentes. Por ese motivo, es necesario que los datos tengan un número suficiente de eventos de fallo. Los eventos de fallo pueden encontrarse en los registros de mantenimiento y en el historial de sustitución de piezas o las anomalías de los datos de entrenamiento también se pueden usar como fallos, tal como identifican los expertos en el dominio.
2. Historial de mantenimiento o reparaciones: un origen de datos esencial para las soluciones de mantenimiento predictivo es el historial de mantenimiento detallado del activo que contiene información acerca de los componentes que se reemplazan, las activaciones de mantenimiento preventivo realizadas, etc. Es muy importante capturar estos eventos, ya que afectan a los patrones de degradación y la ausencia de esta información causa resultados engañosos.
3. Condiciones de la máquina: para predecir cuántos días (horas, millas, transacciones, etc.) más durará una máquina antes de fallar, asumimos que el estado de mantenimiento de la máquina se degrada con el paso del tiempo durante su funcionamiento. Por lo tanto, esperamos que los datos contengan capturas que varían con el tiempo y que capturan este patrón de vencimiento y todas las anomalías que provocan la degradación. En las aplicaciones de IoT, los datos de telemetría de los diferentes sensores representan un buen ejemplo. Para predecir si una máquina va a fallar dentro de un período de tiempo, lo ideal es que los datos capturen la tendencia de la degradación durante dicho período de tiempo antes del evento de fallo real.

Además, se requieren datos que estén directamente relacionada con las condiciones de funcionamiento del activo de destino de la predicción. La decisión de destino se basa tanto en las necesidades empresariales como en la disponibilidad de los datos. Si se usa el ejemplo de predicción de averías en las ruedas del tren, es posible predecir "si se va a producir una avería en la rueda" o "si se va a producir una avería en todo el tren". La primera de las predicciones tiene como destino un componente más específico, mientras que el destino de la segunda tiene como destino un fallo del tren. La segunda predicción es una pregunta más general que requiere muchos elementos de datos más dispersos que la primera, lo que dificulta la generación de un modelo. Por el contrario, intentar predecir los fallos de las ruedas simplemente examinando datos de alto nivel de la condición del tren puede no ser viable, ya que no contienen información a nivel de componente. En general, es más razonable predecir los eventos de fallo específicos que los más generales.

Una pregunta común que suele realizarse acerca de los datos del historial de fallos es "¿Cuántos eventos de error se requieren para entrenar un modelo y cuántos se consideran "suficientes"? No hay ninguna respuesta clara a esa pregunta, ya que en muchos escenarios de análisis predictivo, normalmente es la calidad de los datos lo que determina lo que es aceptable. Si el conjunto de datos no incluye características que sean relevantes para la predicción de fallos, aunque haya muchos eventos de error, no será posible generar un buen modelo. Sin embargo, la regla general es que cuantos más eventos de fallo haya, mejor será el modelo, y una estimación aproximada de cuántos ejemplos de fallos se requieren es una medida muy dependiente del contexto y de los datos. Este problema se describe en la sección sobre la administración de conjuntos de datos desequilibrados, en la que se proponen métodos para hacer frente al problema de no tener suficiente errores.

## <a name="sample-use-cases"></a>Casos de uso de ejemplo
Esta sección se centra en una colección de casos de uso de mantenimiento predictivo de varios sectores, como el aeroespacial, el de servicios públicos y el de transporte. Cada subsección explora los casos de uso recopilados en estas áreas y explica el problema empresarial, los datos que lo rodean y las ventajas de una solución de mantenimiento predictivo.

### <a name="aerospace"></a>Aeroespacial
#### <a name="use-case-1-flight-delay-and-cancellations"></a>Caso de uso 1: retrasos y cancelaciones de vuelos
##### <a name="business-problem-and-data-sources"></a>*Problema empresarial y orígenes de datos*
Uno de los principales problemas empresariales a los que enfrentan las líneas aéreas son los elevados costos que suponen los retrasos de los vuelos por problemas mecánicos. Si los errores mecánicos no se pueden reparar, hasta se pueden cancelar vuelos. Esto es extremadamente costoso, ya que los retrasos provocan problemas de programación y funcionamiento, y causan mala reputación e insatisfacción de los clientes, entre otros problemas. Las líneas aéreas están especialmente interesadas en predecir dichos fallos mecánicos con antelación para poder reducir los retrasos o cancelaciones de vuelos. El objetivo de la solución de mantenimiento predictivo para estos casos es predecir la probabilidad de que se retrase o cancele un vuelo, y dicha predicción se basa en orígenes de datos pertinentes, como el historial de mantenimiento y la información de las rutas de los vuelos. Los dos principales orígenes de datos en este caso de uso son las escalas de los vuelos y los registros de incidencias. Los datos de las escalas incluyen información sobre las rutas de los vuelos, como la fecha y hora de salida y llegada, los aeropuertos de origen y destino, etc. Los datos de los registros de incidencias incluyen una serie de códigos de error y de mantenimiento que registra el personal de mantenimiento.

##### <a name="business-value-of-the-predictive-model"></a>*Valor empresarial del modelo predictivo*
Con los datos históricos disponibles, se generó un modelo predictivo con un algoritmo de clasificación múltiple que predice el tipo de problema mecánico que provoca el retraso o la cancelación de un vuelo en las próximas 24 horas. Al realizar esta predicción, pueden tomarse las acciones de mantenimiento necesarias para reducir el riesgo mientras un avión está en mantenimiento y, así, evitar posibles retrasos o cancelaciones. Con el servicio web Azure Machine Learning, los modelos predictivos pueden integrarse fácilmente y sin ningún problema en las plataformas operativas existentes de las líneas aéreas. 

#### <a name="use-case-2-aircraft-component-failure"></a>Caso de uso 2: fallos en componentes de aviones
##### <a name="business-problem-and-data-sources"></a>*Problema empresarial y orígenes de datos*
Los motores de avión son piezas muy sensibles y caras, y su sustitución es una de las tareas más habituales en el sector aeronáutico. Las soluciones de mantenimiento de las compañías aéreas requieren una cuidadosa administración de la disponibilidad de existencias de los componentes, su entrega y el planeamiento. El mero hecho de poder recopilar información sobre la confiabilidad de los componentes genera una reducción considerable en los costos de inversión. El principal origen de datos principal de este caso de uso son los datos de telemetría recogidos de varios sensores del avión, ya que proporcionan información sobre la condición de la aeronave. También se usaron los registros de mantenimiento para identificar cuándo se produjeron los fallos de los componentes y se sustituyeron estos.

##### <a name="business-value-of-the-predictive-model"></a>Valor empresarial del modelo predictivo
Se generó un modelo de clasificación de varias clases que predice la probabilidad de que se produzca un fallo debido a un componente concreto a lo largo del mes siguiente. Con estas soluciones, las aerolíneas pueden reducir los costos de reparación de componentes, mejorar la disponibilidad de las existencias de componentes, reducir los niveles de activos relacionados en el inventario y mejorar el planeamiento del mantenimiento.

### <a name="utilities"></a>Sectores públicos
#### <a name="use-case-1-atm-cash-dispense-failure"></a>Caso de uso 1: error en la dispensación de efectivo de un cajero automático
##### <a name="business-problem-and-data-sources"></a>*Problema empresarial y orígenes de datos*
Los ejecutivos de sectores con gran cantidad de activos a menudo indican que el principal riesgo operativo para sus empresas son los fallos inesperados de dichos activos. Por ejemplo, un fallo de una máquina como un cajero automático es muy frecuente en el sector bancario. Este tipo de problemas hace que las soluciones de mantenimiento predictivo sean muy deseables para los operadores de dichas máquinas. En este caso de uso, el problema de la predicción es calcular la probabilidad de que se interrumpa una transacción de retirada de efectivo de un cajero automático debido a un fallo en el dispensador de billetes, como un atasco de papel o el fallo de una pieza. Los principales orígenes de datos son las lecturas de los sensores que recopilan datos de medidas cuando se dispensan los billetes y los registros de mantenimiento recopilados con el tiempo. Los datos de los sensores incluían las lecturas de los sensores realizadas en cada transacción completada y lecturas del sensor realizadas cada vez que se dispensa un billete. Las lecturas de los sensores proporcionaban medidas como el espacio entre billetes, el grosor, la distancia de deben recorrer los billetes, etc. Los datos de mantenimiento incluían códigos de error e información de reparación. Estos datos se utilizaron para identificar los casos de fallo.

##### <a name="business-value-of-the-predictive-model"></a>*Valor empresarial del modelo predictivo*
Se crearon dos modelos, con el fin de predecir tanto los fallos en las transacciones de retirada de efectivo como los fallos en cada uno de los billetes dispensados en las transacciones. Al poder predecir los errores en las transacciones con antelación, se puede realizar un mantenimiento proactivo de los cajeros automáticos para evitar errores. Además, con la predicción de fallos en la dispensación de billetes, si existe la probabilidad de que no se realice alguna transacción antes de completarse debido a un fallo en la dispensación de billetes, puede ser preferible detener el proceso y avisar al cliente de que la transacción no se ha completado, en lugar de espera a que llegue el servicio de mantenimiento después de producirse el error, ya que ello puede aumentar la insatisfacción del cliente.

#### <a name="use-case-2-wind-turbine-failures"></a>Caso de uso 2: fallos en turbinas eólicas
##### <a name="business-problem-and-data-sources"></a>*Problema empresarial y orígenes de datos*
Al haber crecido la concienciación medioambiental, las turbinas eólicas han pasado a ser una de las principales fuentes de generación de energía y su costo suele ser de varios millones de dólares. Uno de los componentes clave de las turbinas eólicas es el motor del generador, que está equipado con muchos sensores que facilitan la supervisión de las condiciones y el estado de las turbinas. Las lecturas de los sensor contienen información valiosa que puede usarse para generar un modelo que prediga los indicadores de rendimiento clave (KPI) críticos, como el tiempo medio entre fallos de los componentes de la turbina. Los datos de este caso de uso provienen de varias turbinas eólicas ubicadas en tres lugares distintos de la granja. Las medidas del cerca de un centenar de sensores que tiene cada turbina se registraron cada 10 segundos durante un año. Dichas lecturas incluyen medidas como temperatura, velocidad de generador, potencia de la turbina y devanado del generador.

##### <a name="business-value-of-the-predictive-model"></a>*Valor empresarial del modelo predictivo*
Se generaron modelos predictivos para realizar estimaciones de la vida útil restante de los generadores y sensores de temperatura. Mediante la predicción de la probabilidad de fallo, los técnicos de mantenimiento pueden centrarse en las turbinas que sospechen que puedan fallar pronto para complementar los regímenes de mantenimiento basados en tiempo.
Además, los modelos predictivos proporcionan información sobre el nivel de contribución de los distintos factores distintos a la probabilidad de que se produzca un error, lo que ayuda a las empresas a conocer mejor la causa raíz de los problemas.

#### <a name="use-case-3-circuit-breaker-failures"></a>Caso de uso 3: fallos de disyuntores
##### <a name="business-problem-and-data-sources"></a>*Problema empresarial y orígenes de datos*
Las operaciones de electricidad y gas que incluyen la generación, distribución y venta de energía eléctrica requieren gran cantidad de mantenimiento para asegurarse de que los tendidos eléctricos están operativos en todo momento y así garantizar que llega electricidad a los hogares. Un error en dichas operaciones es crítico, ya que cualquier problema eléctrico afecta prácticamente a todas las entidades de las regiones en que se produzca. Los disyuntores son críticos para estas operaciones, ya que son un componente que corta la corriente eléctrica en caso de problemas y cortocircuitos para evitar que los tendidos eléctricos sufran daños. El problema empresarial de este caso de uso es predecir fallos en disyuntores a partir de los registros de mantenimiento, el historial de órdenes y las especificaciones técnicas.

Los tres principales orígenes de datos de este caso son los registros de mantenimiento, que incluyen acciones correctivas, preventivas y sistemáticas; los datos de funcionamiento, que incluyen las órdenes manuales y automáticas que se envían a los disyuntores, como las acciones de apertura y cierre; y los datos de las especificaciones técnicas acerca de las propiedades de cada disyuntor, como el año de fabricación, la ubicación, el modelo, etc.

##### <a name="business-value-of-the-predictive-model"></a>*Valor empresarial del modelo predictivo*
Las soluciones de mantenimiento predictivo ayudan a reducir los costes de reparación y aumentan el ciclo de vida del equipamiento, como los disyuntores. Estos modelos también ayudan a mejorar la calidad de la red eléctrica, ya que generan advertencias con antelación, lo que reduce el número de errores inesperados y, por consiguiente, el número de interrupciones en el servicio.

#### <a name="use-case-4-elevator-door-failures"></a>Caso de uso 4: fallos en puertas de ascensores
##### <a name="business-problem-and-data-sources"></a>*Problema empresarial y orígenes de datos*
Las mayoría de las grandes compañías de ascensores suelen tener millones de ascensores en funcionamiento por todo el mundo. Para aumentar su competitividad, se centran en la confiabilidad, que es lo más importante para sus clientes. Gracias a que recurren al potencial de Internet de las cosas, lo que les permite conectar los ascensores a la nube y recopilar datos de los sensores y sistemas de los ascensores, pueden transformar dichos datos en valiosa inteligencia empresarial que mejora considerablemente el funcionamiento, ya que permite ofrecer un mantenimiento predictivo y preventivo, algo que aún no está disponible para los competidores. El requisito empresarial de este caso es proporcionar una aplicación predictiva de la base de conocimientos que prediga las posibles causas de los errores en las puertas. Los datos requeridos para esta implementación constan de tres partes: las características estáticas del ascensor (p.ej., identificadores, frecuencia de mantenimiento por contrato, tipo de edificio, etc.), información de uso (p.ej., número de ciclos de las puertas, tiempo medio que tardan en cerrarse las puertas, etc.) e historial de fallos (es decir, registros del historial de fallos y sus causas).

Se generó un modelo de regresión logística de varias clases con Azure Machine Learning para solucionar el problema de predicción, con las características estáticas integradas y los datos de uso como características, y las causas del historial de fallos como etiquetas de clase. Este modelo predictivo se incluye en una aplicación de un dispositivo móvil que usan los técnicos de campo como ayuda para aumentar la eficacia de su trabajo. Cuando un técnico va a reparar un ascensor, puede consultar dicha aplicación para conocer las causas recomendadas y las mejores acciones de mantenimiento para reparar las puertas del ascensor lo antes posible.

### <a name="transportation-and-logistics"></a>Transporte y logística
#### <a name="use-case-1-brake-disc-failures"></a>Caso de uso 1: Averías de disco de freno
##### <a name="business-problem-and-data-sources"></a>*Problema empresarial y orígenes de datos*
Las directivas habituales de mantenimiento de vehículos incluyen un mantenimiento preventivo y correctivo. El mantenimiento correctivo implica que el vehículo se repara después de que se haya producido un fallo, lo que puede ocasionar graves molestias al conductor, debido a una avería inesperada y al tiempo que se pierde al llevar el vehículo al mecánico. La mayoría de los vehículos también están sujetos a una directiva de mantenimiento preventivo, que requiere realizar determinadas inspecciones programadas, independientemente de la condición real de los subsistemas del automóvil. Ninguno de estos enfoques logra eliminar completamente los problemas. Este caso de uso específico es la predicción de averías en discos de frenos basada en los datos recopilados a través de sensores instalados en el sistema de neumáticos de un vehículo que realizan un seguimiento de los patrones históricos de conducción y de otras condiciones a las que está expuesto el automóvil. El origen de datos más importante de este caso son los datos de los sensores, que miden, por ejemplo, las aceleraciones, los patrones de frenado, las distancias recorridas, la velocidad, etc. Esta información, junto con otra información estática, como las características del automóvil, ayudan a generar para desarrollar un buen conjunto de indicadores que pueden usarse en un modelo predictivo. Otro conjunto de información esencial son los datos de los fallos que se deducen de la base de datos de pedidos de piezas (que se usa para mantener las cantidades y fechas de pedidos de piezas de repuesto cuando se reparan los automóviles en los concesionarios).

##### <a name="business-value-of-the-predictive-model"></a>*Valor empresarial del modelo predictivo*
Aquí es importante el valor empresarial de un enfoque predictivo. Un sistema de un mantenimiento predictivo puede programar una visita a un concesionario basándose en un modelo predictivo. El modelo puede basarse en la información de los sensores, que representa la condición actual del automóvil y del historial de conducción. Este enfoque puede reducir el riesgo de fallos inesperados, que también pueden producirse antes del siguiente mantenimiento periódico.
También puede reducir la cantidad de actividades de mantenimiento preventivo innecesarias. Se puede informar proactivamente al conductor de que puede ser necesario cambiar ciertas piezas en pocas semanas y proporcionar dicha información al concesionario. A continuación, el concesionario puede preparar por adelantado un paquete de mantenimiento individual para el conductor.

#### <a name="use-case-2-subway-train-door-failures"></a>Caso de uso 2: fallos en las puertas del metro
##### <a name="business-problem-and-data-sources"></a>*Problema empresarial y orígenes de datos*
Una de las razones principales de los retrasos y problemas de funcionamiento en el metro son los fallos de las puertas de los vagones del metro. Predecir si un vagón puede tener un fallo en una puerta o poder predecir el número de días que falta para que se produzca el siguiente fallo en alguna puerta es una previsión muy importante. Brinda la oportunidad de optimizar el servicio de las puertas de los vagones y reducir el tiempo de inactividad del tren.

#### <a name="data-sources"></a>Orígenes de datos
Los tres orígenes de datos en este caso de uso son: 

* **Datos de eventos de trenes**, que corresponden a los registros históricos de los eventos de tren. 
* **Datos de mantenimiento** , como tipos de mantenimiento, tipos de órdenes de trabajo y códigos de prioridad.  
* **Registros de errores**.

##### <a name="business-value-of-the-predictive-model"></a>*Valor empresarial del modelo predictivo*
Se crearon dos modelos para predecir la probabilidad de error al día siguiente mediante el uso de una clasificación binaria y los días que faltan para el próximo fallo mediante regresión. De forma similar a los casos anteriores, los modelos crean una gran oportunidad de mejorar la calidad del servicio y aumentar la satisfacción del cliente, ya que complementan los regímenes de mantenimiento regular.

## <a name="data-preparation"></a>Preparación de los datos
### <a name="data-sources"></a>Orígenes de datos
Los elementos de datos habituales de los problemas de mantenimiento predictivo se pueden resumir como se especifica a continuación:

* Historial de errores: el registro de errores de una máquina o de algún componente suyo.
* Historial de mantenimiento: el registro de reparaciones de una máquina (p. ej., los códigos de error, las actividades de mantenimiento anteriores o los reemplazos de componentes).
* Condiciones y uso de la máquina: las condiciones de funcionamiento de una máquina (p. ej., los datos obtenidos de los sensores).
* Características de la máquina: los rasgos distintivos de una máquina (p. ej., el tamaño del motor, la marca y el modelo, y la ubicación).
* Características del operador: los rasgos distintivos del operador (p. ej., sexo y experiencia previa).

Habitualmente, el historial de fallos se encuentre dentro del historial de mantenimiento, por ejemplo en forma de códigos de error especiales o fechas de pedido de los recambios. En esos casos, los fallos se pueden extraer de los datos de mantenimiento. Además, los diferentes dominios empresariales pueden tener otros orígenes de datos que afectan a los patrones de fallo que no se enumeran aquí de forma exhaustiva. Estos deben identificarse mediante la realización de consultas a expertos del dominio al crear modelos predictivos.

Estos son algunos ejemplos de los elementos de datos de los casos de uso anteriores:

Historial de averías: las fechas de los retrasos de los vuelos, las fechas y los tipos de averías de los componentes de los aviones, los errores en las transacciones de retirada de efectivo en cajeros automáticos, las averías en las puertas de vagones o ascensores, las fechas de los pedidos de recambios de frenos de disco, las fechas de las averías en las turbinas eólicas y los errores en las órdenes de los disyuntores.

Historial de mantenimiento: registros de errores de vuelos; registros de errores de transacciones de cajeros automáticos; registros de mantenimiento de trenes, que incluyen el tipo de mantenimiento, una descripción breve, etc. y registros de mantenimiento de disyuntores.

Condiciones y uso de la máquina: horas y rutas de vuelos, datos de sensores recopilados de los motores de los aviones, lecturas de sensores de transacciones realizadas en cajeros automáticos, datos de eventos de trenes, lecturas de sensores de turbinas eólicas, ascensores y vehículos conectados.

Características de la máquina: especificaciones técnicas de disyuntores como niveles de tensión, geolocalización o características de los vehículos como marca, modelo, tamaño de motor, tipos de neumáticos, lugar de fabricación, etc.

Dados los orígenes de datos anteriores, los dos tipos de datos principales que observamos en el dominio de mantenimiento predictivo son los datos temporales y los datos estáticos.
El historial de fallos, las condiciones de la máquina, el historial de reparaciones y el historial de uso casi siempre incluyen marcas de tiempo que indican la hora de recopilación de cada fragmento de datos. En general, tanto las características de la máquina como las características del operador son estáticas, ya que suelen describir las especificaciones técnicas de las máquinas o las propiedades del operador. Es posible que estas características cambien con el tiempo y, en ese caso, deben tratarse como orígenes de datos con marca de tiempo.

### <a name="merging-data-sources"></a>Combinación de orígenes de datos
Antes de entrar en cualquier tipo de ingeniería de características o proceso de etiquetado, necesitamos preparar los datos de la forma necesaria para crear características a partir de ellos. El objetivo final es generar un registro de cada unidad de tiempo de cada recurso con sus etiquetas y características que se va a incluir en el algoritmo de aprendizaje automático. Para preparar dicho conjunto de datos finales limpios, es preciso realizar varios pasos previos al procesamiento. El primer paso es dividir la duración de la recolección de datos en unidades de tiempo, en las que cada registro pertenece a una unidad de tiempo de un recurso. La recolección de datos también se puede dividir en otras unidades, como acciones; sin embargo, para simplificar, se usan unidades de tiempo en el resto de las explicaciones.

La unidad de medida del tiempo puede ser segundos, minutos, horas, días, meses, ciclos, millas o transacciones, en función de la eficacia de la preparación de los datos y los cambios observados en las condiciones del recurso de una unidad de tiempo a otra o a otros factores específicos del dominio. En otras palabras, la unidad de tiempo no tiene que ser necesariamente la misma que la frecuencia de recopilación de datos, ya que en muchos casos, puede que los datos no muestren diferencias de una unidad de tiempo a la otra. Por ejemplo, si los valores de temperatura se recopilaban cada 10 segundos, la selección de una unidad de tiempo de 10 segundos para todo el análisis aumenta el número de ejemplos, pero no proporciona información adicional. Una estrategia mejor sería usar más de una hora de media, por ejemplo.

Los esquemas de datos genéricos de ejemplo para los posibles orígenes de datos que se han explicado en la sección anterior son:

Registros de mantenimiento: son los registros de mantenimiento de las acciones realizadas. Normalmente, los datos de mantenimiento sin procesar incluyen un identificador de recurso y una marca de tiempo con información sobre las actividades de mantenimiento que se han realizado en ese momento. En el caso de los datos sin procesar, es preciso trasladar las actividades de mantenimiento a columnas de categorías, en las que cada una de las categorías se corresponde a un tipo de acción de mantenimiento. El esquema de datos básico de los registros de mantenimiento incluye las columnas de identificador del recurso, tiempo y acción de mantenimiento.

Registros de fallos: son los registros que pertenecen al destino de la predicción que llamamos fallos o motivo del fallo. Puede tratarse de códigos de fallo específicos o eventos de error definidos por la condición de la empresa especifica. En algunos casos, los datos incluyen varios códigos de error, algunos de los cuales corresponden a errores de interés. No todos los errores son el destino de predicción, así que los restantes errores normalmente se utilizan para construir características que puedan ponerse en correlación con los fallos. El esquema de datos básico de los registros de fallos incluye las columnas de identificador de recurso, hora y fallo o motivo del fallo, en caso de que haya un motivo.

Condiciones de la máquina: preferiblemente son datos de supervisión en tiempo real sobre las condiciones de operación de los datos. Por ejemplo, en los fallos de las puertas, los tiempos de apertura y cierre de las puertas son buenos indicadores de la condición actual de las puertas. El esquema de datos básico de las condiciones de la máquina incluye las columnas de identificador de recurso, tiempo y valor de la condición.

Datos de la máquina y del operador: los datos de la máquina y del operador se pueden combinar en un esquema para identificar el recurso que ha operado cada operador junto con las propiedades del recurso y del operador. Por ejemplo, un automóvil normalmente pertenece a un conductor con atributos como edad, experiencia de conducción, etc. Si estos datos cambian con el tiempo, también deben incluir una columna de tiempo y se deben tratar como datos que varían con el tiempo en la generación de características. El esquema de datos básico de las condiciones de la máquina incluye las columnas de identificador de recurso, las características del recurso, el identificador de operador y las características del operador.

La tabla final previa al etiquetado y la generación de características se puede generar uniendo por la izquierda la tabla de condiciones de equipos con los registros de fallos de los campos de identificador de recurso y hora. Esta tabla se pueden combinar con los registros de mantenimiento en el identificador de recurso y finalmente al equipo y el operador características en el Id. de recurso y los campos de hora La primera combinación de la izquierda deja valores nulos para la columna de errores cuando el equipo está en funcionamiento normal, dichos valores se pueden imputar mediante el valor de un indicador para el funcionamiento normal. Esta columna de errores se usa para crear etiquetas para el modelo de predicción.

### <a name="feature-engineering"></a>Ingeniería de características
El primer paso del modelado es ingeniería de características. La idea de la generación de características es describir conceptualmente y sintetizar la condición del mantenimiento de un equipo en un momento dado con los datos históricos recopilados hasta ese momento. En la siguiente sección, ofrecemos información general sobre el tipo de técnicas que se pueden usar para el mantenimiento predictivo y cómo se realiza el etiquetado en cada una de ellas. La técnica exacta que se debe usar depende de los datos y del problema empresarial. Sin embargo, los métodos de ingeniería de características que se describen a continuación pueden utilizarse como línea de base para la creación de características. A continuación, trataremos las características de retraso que deben crearse a partir de orígenes de datos que incluyen marcas de tiempo, así como características estáticas creadas a partir de orígenes de datos estáticos y proporcionan ejemplos de los casos de uso.

#### <a name="lag-features"></a>Características de retraso
Como ya se ha mencionado, en el mantenimiento predictivo, los datos históricos suelen incluir marcas de tiempo que indican la hora de recolección de cada fragmento de datos. Hay muchas formas de crear características a partir de los datos que incluyen datos de tiempo. En esta sección se describen algunos de los métodos que se usan para el mantenimiento predictivo. Sin embargo, no estamos limitados por estos métodos. Aunque la ingeniería de características se considera una de las áreas más creativas de modelado predictivo, puede haber muchas otras formas de crear funciones. Aquí se muestran algunas técnicas generales.

##### <a name="rolling-aggregates"></a>*Agregados acumulados*
En cada registro de un recurso, elegimos una ventana móvil de tamaño "W", que es el número de unidades de tiempo para las que nos gustaría calcular agregados históricos. A continuación, calculamos las características de los agregados acumulados mediante los períodos de W anteriores a la fecha de dicho registro. Algunos ejemplos de agregados acumulados pueden ser: recuentos acumulados, medias, desviaciones estándar, valores atípicos basados en desviaciones estándar, medidas de CUSUM y valores mínimo y máximo de la ventana. Otra técnica interesante es capturar los cambios de tendencia, picos y cambios de nivel mediante algoritmos que detectan anomalías en los datos que usan algoritmos de detección de anomalías.

Si desea ver un ejemplo, en la ilustración 1, donde los valores de los sensores registrados para un recurso por cada unidad de tiempo se representan con líneas azules y se marca el cálculo de características de media acumulada para W=3 para los registros de t<sub>1</sub> y t<sub>2</sub>, que se indican mediante grupos verdes y naranjas, respectivamente.

![Figura 1. Características de agregado en ventanas acumuladas](./media/cortana-analytics-playbook-predictive-maintenance/rolling-aggregate-features.png)

Ilustración 1. Características de agregado en ventanas acumuladas

Como ejemplos, en el caso del error de un componente de un avión, se usaron los valores de los sensores de la semana anterior, los últimos tres días y el día anterior para crear medias acumuladas, la desviación estándar y características de suma. De forma similar, en el caso de los errores de los cajeros automáticos, se usaron tanto los valores sin procesar de los sensores como la media acumulada, mediana, intervalo, desviaciones estándar, número de valores atípicos más allá de las tres desviaciones estándar y las características superiores e inferiores de CUMSUM.

En la predicción de los retrasos de vuelos, se usaron los recuentos de códigos de error de la semana anterior se usaron para crear características. En el caso de los errores de las puertas de los vagones de metro, se usaron los recuentos de los eventos del día anterior, los de las dos últimas semanas y la varianza de los recuentos de los eventos de los 15 días anteriores para crear las características de retraso. Para los eventos relacionados con el mantenimiento se usaron los mismos recuentos.

Además, si se elige una W muy grande (por ejemplo, años), se puede examinar todo el historial de un recurso, como el recuento de todos los registros de mantenimiento, errores, etc., hasta el momento del registro. Este método se usó para contar errores de disyuntores durante los tres últimos años. En los errores de los vagones de tren, se contaron todos los eventos de mantenimiento para crear una característica que captura los efectos de mantenimiento a largo plazo.

##### <a name="tumbling-aggregates"></a>*Agregados de saltos de tamaño constante*
En cada registro etiquetado de un recurso, elegimos una ventana de tamaño "W-<sub>k</sub>", donde k es el número de ventanas de tamaño "W" para las que deseamos crear características de retardo. "k" se puede seleccionar como un número grande para capturar patrones de degradación a largo plazo o como un número pequeño para capturar los efectos a corto plazo. A continuación, se usan k ventanas de saltos de tamaño constante W-<sub>k</sub> , W-<sub>(k-1)</sub>, …, W-<sub>2</sub> , W-<sub>1</sub> para crear características agregadas para los periodos previos a la fecha y hora de los registros (consulte la ilustración 2). Estas son también ventanas móviles a nivel de registro para una unidad de tiempo que no se captura en la ilustración 2, pero la idea es la misma que en la ilustración 1, donde t<sub>2</sub> también se utiliza para mostrar el efecto de acumulación.

![Ilustración 2. Características de agregados de saltos de tamaño constante](./media/cortana-analytics-playbook-predictive-maintenance/tumbling-aggregate-features.png)

Ilustración 2. Características de agregados de saltos de tamaño constante

Por ejemplo, en el caso de las turbinas eólicas, se usaron W = 1 y k = 3 meses para crear características de retraso para cada uno de los tres últimos meses con valores atípicos superior e inferior.

#### <a name="static-features"></a>Características estáticas
Son las especificaciones técnicas del equipo, como la fecha de fabricación, el número de modelo, la ubicación, etc. Aunque las características de retraso son en su mayoría numéricas por naturaleza, las características estáticas suelen convertirse en variables de categorías en los modelos. Como ejemplo, se usaron las propiedades de los disyuntores,  como las especificaciones de tensión, corriente y potencia, junto con los tipos de transformador, las fuentes de alimentación, etc. En el caso de las averías en los frenos de disco, el tipo de neumáticos, de aleación o de acero, se usa como una de las características estáticas.

Durante la generación de características, deben realizarse otros pasos importantes como el control de los valores que faltan y la normalización. Hay varios métodos de imputación de valores que faltan y de normalización de datos que no se tratan aquí. Sin embargo, se recomienda probar métodos distintos para constatar si puede mejorarse el rendimiento de las predicciones.

La tabla de características finales, que aparece después de los pasos de ingeniería de características de la sección anterior debería ser similar el siguiente esquema de datos de ejemplo cuando la unidad de tiempo es un día:

| Identificador de recurso | Hora | Columnas de característica | Etiqueta |
| --- | --- | --- | --- |
| 1 |Día 1 | | |
| 1 |Día 2 | | |
| ... |... | | |
| 2 |Día 1 | | |
| 2 |Día 2 | | |
| ... |... | | |

## <a name="modeling-techniques"></a>Técnicas de modelado
El mantenimiento predictivo es un dominio muy amplio que a menudo emplea preguntas empresariales, a las que es posible acercarse desde los distintos ángulos de la perspectivas del modelado predictivo. En las secciones siguientes, se proporcionan las principales técnicas que se usan para modelar las distintas preguntas empresariales que se pueden responder con las soluciones de mantenimiento predictivo. Aunque existen similitudes, cada modelo tiene su propia manera de crear etiquetas y cada una de esas manera se describe más detalladamente. Como recurso adicional, puede consultar la plantilla de mantenimiento predictivo que se incluye en los experimentos de ejemplo que se proporcionan con Azure Machine Learning. Los vínculos al material en línea de esta plantilla se proporcionan en la sección de recursos. Puede ver que tanto algunas de las técnicas de ingeniería de características que se han descrito como la técnica de modelado que se describe en las secciones siguientes se aplican para predecir los errores de los motores de aviones con Azure Machine Learning.

### <a name="binary-classification-for-predictive-maintenance"></a>Clasificación binaria para mantenimiento predictivo
La clasificación binaria para el mantenimiento predictivo se usa para predecir la probabilidad de que en un equipamiento se produzca un error en el futuro. El período se basa tanto en las reglas de negocios como en los datos a mano, y también queda determinado por ambos elementos. Algunos períodos comunes son el plazo mínimo necesario para comprar repuestos para reemplazar los componentes que es probable que sufran daños o el tiempo necesario para implementar recursos de mantenimiento para realizar rutinas de mantenimiento para corregir el problema que es probable que se produzca en ese periodo. A este periodo de horizonte futuro lo llamamos "X".

Para utilizar la clasificación binaria, es preciso identificar dos tipos de ejemplos, que llamamos positivos y negativos. Cada ejemplo es un registro que pertenece a una unidad de tiempo de un recurso que describe y sintentiza conceptualmente sus condiciones de funcionamiento hasta dicha unidad de tiempo mediante una ingeniería de características que usa datos históricos y otros orígenes de datos que se ha descrito anteriormente. En el contexto de la clasificación binaria del mantenimiento predictivo, el tipo positivo denota errores (etiqueta 1) y el tipo negativo denota las operaciones normales (etiqueta = 0), donde las etiquetas son del tipo de categoría. El objetivo es encontrar un modelo que identifique la probabilidad de que se produzca un error en cada ejemplo nuevo o de que funcione normalmente en las próximas X unidades de tiempo.

#### <a name="label-construction"></a>Construcción de etiquetas
Para crear un modelo predictivo que responda a la pregunta "¿Qué probabilidad hay de que se produzca un error en el recurso en las X próximas unidades de tiempo?", el etiquetado se realiza tomando X registros antes del error de un recurso y etiquetándolos como "a punto de error" (etiqueta = 1) y etiquetando el resto como "normal" (etiqueta = 0). En este método, las etiquetas son variables de categoría (consulte la ilustración 3).

![Figura 3. Etiquetado para clasificación binaria](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-binary-classification.png)

Figura 3. Etiquetado para clasificación binaria

En el caso de las cancelaciones y retrasos en los vuelos, X es un día, con el fin de predecir los retrasos que se pueden producir en las 24  horas siguientes. Todos los vuelos que están dentro de las 24 horas antes de los errores se etiquetaron como 1s. En el caso de los errores en la dispensación de efectivo en los cajeros automáticos, se generaron dos modelos de clasificación binaria para predecir la probabilidad de error de una transacción en los próximos 10 minutos, así como para predecir la probabilidad de error en los 100 próximos billetes que se van a dispensar. Todas las transacciones que se hayan realizado en los 10 últimos minutos del error se etiquetan como 1 en el primer modelo. Y todos los billetes dispensados dentro de las 100 últimos billetes de un error se etiquetan como 1 para el segundo modelo. En el caso de los errores de los disyuntores, la tarea es predecir la probabilidad de que se produzca un error en la siguiente orden del disyuntor, en cuyo caso se elige que X sea una orden futura. En el caso de los errores de las puertas de los vagones del metro, el modelo de clasificación binaria se creó para predecir errores en los 7 días posteriores. En el caso de los errores en las turbinas eólicas, se eligió que X fuera 3 meses.

Los casos de las turbinas eólicas y las puertas de los vagones también se usan para que el análisis de regresión prediga la vida útil restante con los mismos datos, pero con otra estrategia de etiquetado que se explica en la sección siguiente.

### <a name="regression-for-predictive-maintenance"></a>Regresión para mantenimiento predictivo
En el mantenimiento predictivo, los modelos de regresión se utilizan para calcular la vida útil restante de un recurso, que se define como el tiempo que el recurso está operativo antes de que se produzca el siguiente error. Al igual que en la clasificación binaria, cada ejemplo es un registro que pertenece a una unidad de tiempo "Y" de un recurso. Sin embargo, en el contexto de la regresión, el objetivo es encontrar un modelo que calcule la vida útil restante de cada nuevo ejemplo como un número continuo, que es el período que queda antes del error. Este periodo es un múltiplo de Y. Los ejemplos también tienen una vida útil restante que puede calcularse mediante la medición del periodo que falta en ese ejemplo para que se produzca el siguiente error.

#### <a name="label-construction"></a>Construcción de etiquetas
Dada la pregunta "¿Cuál es la vida útil restante del equipamiento?
", para crear las etiquetas del modelo de regresión se toma cada registro anterior al error y se etiqueta calculando el número de unidades de tiempo que faltan para el siguiente error. En este método, las etiquetas son variables continuas (consulte la ilustración 4).

![Figura 4. Etiquetado de la regresión](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-regression.png)

Figura 4. Etiquetado de la regresión

En la regresión, a diferencia de la clasificación binaria, no se pueden usar recursos sin errores en los datos para el modelado, porque el etiquetado se hace en referencia a un punto de error y su cálculo no es posible sin saber cuánto tiempo sobrevivió el recurso antes del error. Este problema se aborda mejor con otra técnica estadística llamada Análisis de supervivencia.
No vamos a hablar del Análisis de supervivencia en este cuaderno de estrategias por las posibles complicaciones que pueden surgir al aplicar la técnica en casos de uso de un mantenimiento predictivo que implican datos variables en el tiempo con intervalos frecuentes.

### <a name="multi-class-classification-for-predictive-maintenance"></a>Clasificación multiclase para mantenimiento predictivo
La clasificación multiclase para mantenimiento predictivo puede usarse para predecir dos resultados futuros. El primero es para asignar un activo a uno de varios posibles períodos de tiempo para ofrecer un intervalo de tiempo de error a cada activo. La segunda es para identificar la probabilidad de error en el futuro debido a una de las diferentes causas raíz. Eso permite al personal de mantenimiento que posee este conocimiento controlar los problemas de antemano. Otra técnica de modelado multiclase se centra en determinar la causa raíz más probable de un error dado. Esto permite recomendar las principales acciones de mantenimiento que deben realizarse para corregir un error.
Al tener una lista clasificada de causas raíz y las acciones de reparación asociadas,  
los técnicos pueden mejorar su eficacia para realizar sus primeras acciones de reparación después de los errores.

#### <a name="label-construction"></a>Construcción de etiquetas
Dadas las dos preguntas, que son: "¿Cuál es la probabilidad de que un recurso genere un error en las siguientes "aZ" unidades de tiempo?, donde "a" es el número de períodos", y "¿Cuál es la probabilidad de que el recurso genere un error en las siguientes X unidades de tiempo debido al problema "P<sub>i</sub>"?, donde "i" es el número de causas raíz posibles, el etiquetado se realiza de la siguiente manera para estas técnicas.

En el caso de la primera pregunta, para realizar el etiquetado se toman registros aZ antes del error de un activo y se etiquetan usando depósitos de tiempo (3Z, 2Z, Z) como etiquetas, mientras que todos los demás registros se etiquetan como "normal" (etiqueta=0). En este método, la etiqueta es una variable de categoría (consulte la ilustración 5).

![Figura 5. Etiquetado de la clasificación multiclase para predecir el momento del error](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-multiclass-classification-for-failure-time-prediction.png)

Figura 5. Etiquetado de la clasificación multiclase para predecir el momento del error

En el caso de la segunda pregunta, para realizar el etiquetado se toman registros X antes del error de un activo y se etiquetan como “a punto de presentar error debido a un problema P<sub>i</sub>” (etiqueta = P<sub>i</sub>), mientras que todos los demás registros se etiquetan como "normal" (etiqueta=0). En este método, las etiquetas son variables de categoría (consulte la ilustración 6).

![Figura 6. Etiquetado de la clasificación multiclase para predecir la causa del error](./media/cortana-analytics-playbook-predictive-maintenance/labelling-for-multiclass-classification-for-root-cause-prediction.png)

Figura 6. Etiquetado de la clasificación multiclase para predecir la causa del error

El modelo asigna una probabilidad de error debido a cada P<sub>i</sub>, así como la probabilidad de que no se produzca ningún error. Estas probabilidades se pueden ordenar por magnitud para permitir la predicción de los problemas que es más probable que ocurran en el futuro. Un caso de uso de errores de componentes de avión se estructuró como un problema de clasificación multiclase. Esto permite predecir las probabilidades de que se produzca un error debido a dos componentes diferentes de la válvula de presión en el próximo mes.

Para recomendar las acciones de mantenimiento después de los errores, el etiquetado no requiere seleccionar un horizonte futuro. Esto se debe a que el modelo no predice errores en el futuro, tan solo predice la causa raíz más probable una vez que producido el error. Los errores de las puertas de los elevadores pertenecen al tercer caso, en el que el objetivo es predecir la causa del error con los datos históricos sobre las condiciones de funcionamiento. Este modelo se usará después para predecir las causas raíz más probables después de que se produzca un error. Una ventaja clave de este modelo es que ayuda a los técnicos menos expertos a diagnosticar y corregir fácilmente problemas para los que, de otro modo, necesitarían años de experiencia.

## <a name="training-validation-and-testing-methods-in-predictive-maintenance"></a>Métodos de aprendizaje, validación y pruebas en el mantenimiento predictivo
De forma similar a otros espacios de soluciones que contienen datos con marca de fecha y hora, en el mantenimiento predictivo, la rutina habitual de entrenamiento y pruebas tiene que tener en cuenta los aspectos variables en el tiempo para generalizar mejor en datos futuros no vistos.

### <a name="cross-validation"></a>Validación cruzada
Muchos algoritmos de aprendizaje automático dependen de diferentes hiperparámetros que pueden cambiar significativamente el rendimiento del modelo. Los valores óptimos de estos hiperparámetros no se calculan automáticamente al entrenar el modelo, lo deben especificar los científicos de datos. Hay varias formas de buscar los valores correctos para los hiperparámetros. El más común es la "validación cruzada con k iteraciones" que divide los ejemplos aleatoriamente en "k" iteraciones. Para cada conjunto de valores de hiperparámetro, el algoritmo de aprendizaje se ejecuta k veces. En cada iteración, se usan los ejemplos de la iteración actual como un conjunto de validación; el resto de los ejemplos se usan como un conjunto de entrenamiento. El algoritmo se entrena con los ejemplos de entrenamiento y las métricas de rendimiento se calculan con los ejemplos de validación. Al final de este bucle para cada conjunto de valores de hiperparámetro, se calcula el promedio de los valores de las métricas de rendimiento de k y se eligen los valores de hiperparámetro que tienen el mejor promedio de rendimiento.

Como se mencionó antes, en los problemas de mantenimiento predictivo, los datos se registran como una serie temporal de eventos procedentes de diversos orígenes de datos. Estos registros se pueden ordenar según la hora de etiquetado de un registro o un ejemplo. Por lo tanto, si dividimos el conjunto de datos aleatoriamente en el conjunto de entrenamiento y el de validación, algunos de los ejemplos de entrenamiento serán posteriores a algunos de los ejemplos de validación. Esto realiza una estimación del rendimiento futuro de los valores de hiperparámetro en función de los datos que llegaron antes de que el modelo se entrenara. Estas estimaciones podrían resultar extremadamente optimistas, especialmente si las series temporales no son fijas y cambian su comportamiento con el tiempo. Como resultado, los valores de hiperparámetro elegidos podrían no ser los óptimos.

Una mejor manera de buscar buenos valores de hiperparámetro es dividir los ejemplos en conjuntos de entrenamiento y validación de manera dependiente del tiempo, de forma que todos los ejemplos de validación sean posteriores en el tiempo a todos los ejemplos de entrenamiento. Después, para cada conjunto de valores de hiperparámetro, el algoritmo se entrena con el conjunto de entrenamiento, se mide el rendimiento del modelo sobre el mismo conjunto de validación y se eligen los valores de hiperparámetro que muestren el mejor rendimiento. Cuando los datos de las series temporales no son fijos y evolucionan con el tiempo, los valores de hiperparámetro elegidos por la división en entrenamiento y validación producen un mejor rendimiento futuro del modelo que los que la validación cruzada elige aleatoriamente.

El modelo final se genera mediante el entrenamiento de un algoritmo de aprendizaje con todos los datos, usando los mejores valores de hiperparámetro que se encuentran mediante división en entrenamiento y validación o mediante validación cruzada.

### <a name="testing-for-model-performance"></a>Pruebas de rendimiento del modelo
Después de generar un modelo, debemos realizar una estimación de su rendimiento futuro con nuevos datos. La estimación más sencilla podría ser el rendimiento del modelo con los datos de entrenamiento. Pero esta estimación es demasiado optimista, ya que el modelo está adaptado a los datos que se usan para calcular el rendimiento. Una estimación más adecuada podría ser una métrica de rendimiento de los valores de hiperparámetro calculada con el conjunto de validación o una métrica de rendimiento promedio calculada mediante validación cruzada. Pero por las mismas razones mencionadas anteriormente, estas estimaciones siguen siendo demasiado optimistas. Necesitamos enfoques más realistas para medir el rendimiento del modelo.

Una manera es dividir los datos de forma aleatoria en conjuntos de entrenamiento, validación y prueba. Los conjuntos de entrenamiento y validación se usan para seleccionar valores de hiperparámetro y entrenar el modelo con ellos. El rendimiento del modelo se mide con el conjunto de pruebas.

Otra forma adecuada para el modelo predictivo es dividir los ejemplos en conjuntos de entrenamiento, validación y pruebas de manera dependiente del tiempo, de forma que todos los ejemplos de prueba sean posteriores en el tiempo a todos los ejemplos de entrenamiento y validación. Después de la división, la generación del modelo y la medición del rendimiento se realizan de la forma descrita antes.

Cuando las series temporales son fijas y fáciles de predecir, ambos enfoques generan estimaciones similares del rendimiento futuro. Pero cuando las series temporales no son fijas o son difíciles de predecir, el segundo enfoque generará estimaciones más realistas estimaciones del rendimiento futuro que el primero.

### <a name="time-dependent-split"></a>División dependiente del tiempo
Como práctica recomendada, en esta sección veremos con más detalle cómo implementar divisiones dependientes del tiempo. Describimos una división de dos formas dependiente del tiempo entre conjuntos de entrenamiento y de prueba, aunque se debe aplicar exactamente la misma lógica para la división dependiente del tiempo en conjuntos de entrenamiento y validación.

Supongamos que tenemos una secuencia de eventos con marca de fecha y hora, tales como medidas de diferentes sensores. Las características de los ejemplos de entrenamiento y de prueba, así como sus etiquetas, se definen en períodos de tiempo que contienen varios eventos.
Por ejemplo, para la clasificación binaria, tal y como se describe en las secciones de ingeniería de características y técnicas de modelado, las características se crean en función de los eventos pasados y las etiquetas se crean en función de los eventos futuros que se produzcan en "X" unidades de tiempo en el futuro. Por lo tanto, el período de tiempo del etiquetado de un ejemplo es posterior al período de tiempo de sus características. Para la división dependiente del tiempo, seleccionamos un punto en el tiempo en el que se entrenará un modelo con hiperparámetros optimizados mediante el uso de datos históricos hasta ese punto. Para evitar que etiquetas futuras que están más allá del límite de entrenamiento se fuguen a los datos de entrenamiento, elegimos el período de tiempo más reciente para etiquetar los ejemplos de formación en X unidades antes de la fecha límite de entrenamiento. En la ilustración 7, cada círculo sólido representa una fila en el conjunto de datos de características finales para el que se calculan las características y las etiquetas según el método descrito anteriormente. Con esta premisa, la ilustración muestra los registros que deben ir en los conjuntos de entrenamiento y de prueba al implementar la división dependiente del tiempo para X=2 y W=3:

![Figura 7. División dependiente del tiempo para la clasificación binaria](./media/cortana-analytics-playbook-predictive-maintenance/time-dependent-split-for-binary-classification.png)

Figura 7. División dependiente del tiempo para la clasificación binaria

Los cuadrados verdes representan los registros que pertenecen a las unidades de tiempo que pueden usarse para el entrenamiento. Como se explicó antes, cada ejemplo de entrenamiento de la tabla de características final se genera consultando tres períodos pasados para la generación de características y dos períodos futuros para el etiquetado antes del día límite de entrenamiento. No usamos ejemplos en el conjunto de entrenamiento si alguna parte de los 2 períodos futuros para ese ejemplo está fuera del límite de entrenamiento porque damos por hecho que no tenemos visibilidad más allá del límite de entrenamiento. Debido a esa restricción, los ejemplos en negro representan los registros del conjunto de datos etiquetados final que no se deben usar en el conjunto de datos de entrenamiento. Estos registros no se usarán en los datos de prueba porque son anteriores al límite de entrenamiento y sus períodos de etiquetado dependen parcialmente del período de entrenamiento, lo que no debería ser el caso, ya que nos gustaría separar totalmente los períodos de etiquetado para el entrenamiento y las pruebas a fin de prevenir la fuga de información del etiquetado.

Esta técnica permite que los ejemplos de entrenamiento y de prueba que están próximos al límite de entrenamiento se superpongan en los datos usados para la generación de características. Según la disponibilidad de datos, puede realizarse una separación aún más drástica y no usar ninguno de los ejemplos del conjunto de prueba que están dentro de W unidades de tiempo del límite de entrenamiento.

En nuestro trabajo descubrimos que los modelos de regresión usados para predecir la vida útil restante se ven más gravemente afectados por el problema de la fuga y que el uso de una división aleatoria produce un sobreajuste extremo. De forma similar, en problemas de regresión, la división deberá realizarse de manera que los registros que pertenecen a activos con errores anteriores al límite de entrenamiento deberán usarse para el conjunto de entrenamiento y los activos con errores posteriores al límite deberán usarse para el conjunto de prueba.

Por regla general, otro procedimiento recomendado importante para dividir los datos para entrenamiento y prueba es usar una división por ID de activo para que ninguno de los activos que se usaron en el entrenamiento se usen en las pruebas. El motivo es que, en las pruebas, la idea es asegurarse de que cuando se use un nuevo activo para hacer predicciones, el modelo proporcione resultados realistas.

### <a name="handling-imbalanced-data"></a>Control de datos desequilibrados
En los problemas de clasificación, si hay más ejemplos de una clase que de otra, se dice que los datos están desequilibrados. Lo ideal es tener suficientes representantes de cada clase en los datos de entrenamiento para poder diferenciar entre las distintas clases. Si una clase tiene menos del 10 % de los datos, podemos decir que los datos están desequilibrados y llamamos clase minoritaria al conjunto de datos insuficientemente representado. En muchos casos encontramos conjuntos de datos desequilibrados en los que una clase está mucho menos representada que otras, por ejemplo, que solo constituye el 0,001 % de los puntos de datos. El desequilibrio de clases es un problema en muchos ámbitos, incluidos la detección de fraudes, la intrusión en redes y el mantenimiento predictivo, en los que los errores se dan rara vez en la vida de los activos que componen los ejemplos de la clase minoritaria.

En caso de un desequilibrio de clases, el rendimiento de la mayoría de los algoritmos de aprendizaje estándar se ve comprometido, ya que intentan minimizar la tasa general de errores. Por ejemplo, para un conjunto de datos con un 99 % de ejemplos de clase negativos y un 1 % de ejemplos de clase positivos, podemos obtener un 99 % de precisión simplemente etiquetando todas las instancias como negativas. Sin embargo, esto clasifica erróneamente todos los ejemplos positivos, por lo que el algoritmo no es útil aunque la métrica de precisión sea muy alta. Por lo tanto, las métricas de evaluación convencionales tales como la precisión global en la tasa de errores no son suficientes en el caso del aprendizaje desequilibrado. En la sección Métricas de evaluación se describen otras métricas, como la precisión, la recuperación, las puntuaciones F1 y las curvas de ROC con ajuste del costo, que se usan para las evaluaciones de conjuntos de datos desequilibrados.

Sin embargo, hay algunos métodos que ayudan a solucionar el problema de desequilibrio de clases. Las dos más importantes son las técnicas de muestreo y el aprendizaje sensible al costo.

#### <a name="sampling-methods"></a>Métodos de muestreo
El uso de métodos de muestreo en el aprendizaje desequilibrado consiste en modificar el conjunto de datos mediante algunos mecanismos para proporcionar un conjunto de datos equilibrado. Aunque hay muchas técnicas de muestreo diferentes, las más directas son el sobremuestreo y el submuestreo aleatorios.

Dicho de manera sencilla, el sobremuestreo aleatorio consiste en seleccionar una muestra aleatoria de una clase minoritaria, replicar estos ejemplos y agregarlos al conjunto de datos de entrenamiento. Esto aumenta el número de ejemplos totales en la clase minoritaria y finalmente equilibraría el número de ejemplos de las diferentes clases. Un peligro del sobremuestreo es que varias instancias de ciertos ejemplos pueden hacer que el clasificador sea demasiado específico y provocar un sobreajuste.
Esto produciría una gran precisión del entrenamiento pero el rendimiento de los datos de prueba no vistos puede ser muy deficiente. Por el contrario, el submuestreo aleatorio consiste en seleccionar una muestra aleatoria de una clase mayoritaria y quitar esos ejemplos del conjunto de datos de entrenamiento. Sin embargo, quitar ejemplos de la clase de mayoría podría provocar que el clasificador pase por alto conceptos importantes relacionados con la clase mayoritaria. Otro enfoque viable es un muestreo híbrido que consiste en realizar un sobremuestreo de una clase minoritaria y un submuestreo de una clase mayoritaria. Existen muchas otras técnicas de muestreo más sofisticadas y la búsqueda de métodos de muestreo eficaces para el desequilibrio de clases es un área popular que recibe atención constante y contribuciones de muchos canales. Normalmente se deja a los científicos de datos la investigación y experimentación de diferentes técnicas para decidir cuáles son las más eficaces, y son muy dependientes de las propiedades de los datos. Además, es importante asegurarse de que los métodos de muestreo se aplican solo al conjunto de entrenamiento y no al conjunto de prueba.

#### <a name="cost-sensitive-learning"></a>Aprendizaje sensible al costo
En el mantenimiento predictivo, los errores que constituyen la clase minoritaria tienen más interés que los ejemplos normales y, por lo tanto, el punto de atención es el rendimiento del algoritmo sobre los errores. Esto se conoce normalmente como pérdida desigual o costos asimétricos de la clasificación errónea de elementos de diferentes clases, y la predicción incorrecta de un positivo como negativo puede costar más que al contrario. El clasificador deseado debe ser capaz de proporcionar una gran precisión de predicción en la clase minoritaria sin poner en riesgo la precisión de la clase de mayoría.

Hay varias maneras de lograrlo. El problema de las pérdidas desiguales se puede tratar de forma eficaz asignando un alto costo a la clasificación errónea de la clase minoritaria y tratando de minimizar el costo general. Algunos algoritmos de aprendizaje automático usan esta idea de forma inherente, por ejemplo, las SVM (máquinas de soporte vectorial) en las que el costo de los ejemplos positivos y negativos se puede incorporar durante el tiempo de entrenamiento. De forma similar, se usan métodos de incremento y normalmente muestran un buen rendimiento en caso de datos desequilibrados tales como algoritmos de árbol de decisiones incrementados.

## <a name="evaluation-metrics"></a>Métricas de evaluación
Como se mencionó anteriormente, el desequilibrio de clases provoca un bajo rendimiento porque los algoritmos tienden a clasificar mejor los ejemplos de la clase mayoritaria a costa de los casos de la clase minoritaria, porque los errores totales clasificación errónea mejoran mucho cuando la clase mayoritaria se etiqueta correctamente. Esto provoca bajas tasas de recuperación y se convierte en un problema mayor cuando el costo de las falsas alarmas para la empresa es muy alto. La precisión es la métrica más popular que se usa para describir el rendimiento de un clasificador. Sin embargo, tal y como se explicó anteriormente, la precisión no resulta eficaz y no refleja el rendimiento real de la funcionalidad de un clasificador porque es muy sensible a las distribuciones de los datos. En su lugar se usan otras métricas de evaluación para valorar los problemas de aprendizaje desequilibrado. En esos casos, la precisión, la recuperación y las puntuaciones F1 deben ser las primeras métricas que se consulten al evaluar el rendimiento de un modelo de mantenimiento predictivo. En el mantenimiento predictivo, las tasas de recuperación indican cuántos errores del conjunto de prueba identificó correctamente el modelo. Las tasas de recuperación mayores indican que el modelo pudo detectar correctamente los errores verdaderos. La métrica de precisión está relacionada con la tasa de falsas alarmas, y las tasas de precisión menores se corresponden con un número mayor de falsas alarmas. La puntuación F1 tiene en cuenta tanto la tasa de precisión y como de recuperación, siendo 1 el mejor valor y 0 el peor.

Además, en la clasificación binaria, las tablas de deciles y los gráficos de elevación proporcionan mucha información a la hora de evaluar el rendimiento. Se centran solo en la clase positiva (errores) y proporcionan una imagen más compleja del rendimiento del algoritmo que la que obtenemos mirando solo un punto operativo fijo en la curva ROC (característica de funcionamiento del receptor).
Las tablas de deciles se obtienen ordenando los ejemplos de prueba según sus probabilidades de error, calculadas por el modelo antes de aplicar un umbral para decidir la etiqueta final. Los ejemplos ordenados se agrupan en deciles (es decir, el 10 % de ejemplos con mayor probabilidad, después el 20 %, el 30 % y así sucesivamente). Calculando la relación entre la tasa de positivos verdaderos de cada decil y su línea base aleatoria (es decir, 0,1, 0,2...) se puede realizar una estimación de cómo cambia el rendimiento del algoritmo en cada decil. Los gráficos de elevación se usan para trazar valores de deciles; para ello, se trazan pares de tasa de positivos verdaderos y tasa de positivos verdaderos aleatorios para todos los deciles. Normalmente, los primeros deciles son el foco de los resultados porque aquí vemos las mayores ganancias. Los primeros deciles también pueden verse como representativos de "en riesgo" cuando se usan para el mantenimiento predictivo.

## <a name="sample-solution-architecture"></a>Ejemplo de arquitectura de solución
Al implementar una solución de mantenimiento predictivo, nos interesa una solución completa que proporcione un ciclo continuo de entrada de datos, almacenamiento de datos para el entrenamiento del modelo, generación de características, predicción y visualización de los resultados, y un mecanismo de generación de alertas, por ejemplo, un panel de supervisión de activos. Queremos una canalización de datos que proporcione datos detallados futuros al usuario de forma continua y automatizada. La ilustración 8 muestra un ejemplo de arquitectura de mantenimiento predictivo para una canalización de datos de IoT de este tipo. En la arquitectura, se recopila telemetría en tiempo real en un Centro de eventos que almacena los datos de streaming. El análisis de transmisión toma estos datos para realizar un procesamiento en tiempo real de datos tales como la generación de características. Después, las características se usan para llamar al servicio web de modelo predictivo y los resultados se muestran en el panel. Al mismo tiempo, los datos incorporados se almacenan también en una base de datos histórica y se combinan con orígenes de datos externos tales como bases de datos locales para crear ejemplos de entrenamiento para el modelado.
Se pueden usar los mismos almacenes de datos para la puntuación por lotes de los ejemplos y para el almacenamiento de los resultados que, de nuevo, pueden usarse para proporcionar informes predictivos en el panel.

![Figura 8. Ejemplo de arquitectura de solución para mantenimiento predictivo](./media/cortana-analytics-playbook-predictive-maintenance/example-solution-architecture-for-predictive-maintenance.png)

Figura 8. Ejemplo de arquitectura de solución para mantenimiento predictivo

Para obtener más información acerca de cada uno de los componentes de la arquitectura, consulte la  documentación de [Azure](https://azure.microsoft.com/) .

